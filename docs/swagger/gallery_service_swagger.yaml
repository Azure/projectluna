swagger: '2.0'
info:
  title: Luna.Gallery.Functions
  version: V1
host: localhost:7071
schemes:
  - http
paths:
  /api/applications:
    get:
      tags:
        - Application
      summary: List published applications
      operationId: getApiApplications
      produces:
        - application/json
      responses:
        '200':
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.PublishedLunaApplication'
            example:
              UniqueName: mylunaapp
              DisplayName: My Luna App
              Description: This is my Luna app
              LogoImageUrl: https://aka.ms/lunalog.png
              DocumentationUrl: https://aka.ms/lunadoc
              Publisher: Microsoft
              Tags: [ ]
              Details:
                APIs: [ ]
      security:
        - x-functions-key: [ ]
  '/api/applications/{name}/recommended':
    get:
      tags:
        - Application
      summary: Get recommended Luna applications
      operationId: getApiApplicationsByNameRecommended
      produces:
        - application/json
      parameters:
        - in: path
          name: name
          description: Name of Luna application
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.PublishedLunaApplication'
            example:
              UniqueName: mylunaapp
              DisplayName: My Luna App
              Description: This is my Luna app
              LogoImageUrl: https://aka.ms/lunalog.png
              DocumentationUrl: https://aka.ms/lunadoc
              Publisher: Microsoft
              Tags: [ ]
              Details:
                APIs: [ ]
      security:
        - x-functions-key: [ ]
  '/api/applications/{name}':
    get:
      tags:
        - Application
      summary: Get a published Luna application
      operationId: getApiApplicationsByName
      produces:
        - application/json
      parameters:
        - in: path
          name: name
          description: Name of Luna application
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.PublishedLunaApplication'
      security:
        - x-functions-key: [ ]
  '/api/applications/{name}/swagger':
    get:
      tags:
        - Application
      summary: Get swagger in JSON format for a published Luna application
      operationId: getApiApplicationsByNameSwagger
      produces:
        - application/json
      parameters:
        - in: path
          name: name
          description: Name of Luna application
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationDetails'
      security:
        - x-functions-key: [ ]
  '/api/applications/{appName}/subscriptions/{subscriptionName}':
    put:
      tags:
        - Subscription
      summary: Create a subscription of a published Luna application
      operationId: putApiApplicationsByAppNameSubscriptionsBySubscriptionName
      produces:
        - application/json
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: path
          name: subscriptionName
          description: Name of the subscription
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the creator
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscription'
      security:
        - x-functions-key: [ ]
  '/api/applications/{appName}/subscriptions':
    get:
      tags:
        - Subscription
      summary: List all subscriptions of a published Luna application
      operationId: getApiApplicationsByAppNameSubscriptions
      produces:
        - application/json
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the caller
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscription'
            example:
              SubscriptionId: 43ebb35e-be1a-4dbf-92da-fb8a069d6a2c
              SubscriptionName: mysub
              PrimaryKey: a76e55da5d6c4a489c4f5e4033ac3488
              SecondaryKey: d235f6c4bf86495c9dd37c1f44f817ac
              BaseUrl: https://luna.azurewebapp.net/api
              Notes: this is my subscription
              Owners:
                - UserId: fcd14a2a-31d3-49c1-9e1b-39063da1ac6a
                  UserName: FirstName LastName
              CreatedTime: '2021-06-07T15:36:51.3036072+00:00'
      security:
        - x-functions-key: [ ]
  '/api/applications/{appName}/subscriptions/{subscriptionNameOrId}':
    get:
      tags:
        - Subscription
      summary: Get a subscription of a published Luna application
      operationId: getApiApplicationsByAppNameSubscriptionsBySubscriptionNameOrId
      produces:
        - application/json
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: path
          name: subscriptionNameOrId
          description: Name or id of the subscription
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the creator
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscription'
      security:
        - x-functions-key: [ ]
    delete:
      tags:
        - Subscription
      summary: Delete a subscription of a published Luna application
      operationId: deleteApiApplicationsByAppNameSubscriptionsBySubscriptionNameOrId
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: path
          name: subscriptionNameOrId
          description: Name or id of the subscription
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the creator
          required: true
          type: string
      responses:
        '204':
          description: Success
      security:
        - x-functions-key: [ ]
  '/api/applications/{appName}/subscriptions/{subscriptionNameOrId}/UpdateNotes':
    post:
      tags:
        - Subscription
      summary: Update notes of a subscription
      operationId: postApiApplicationsByAppNameSubscriptionsBySubscriptionNameOrIdUpdateNotes
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: path
          name: subscriptionNameOrId
          description: Name or id of the subscription
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the creator
          required: true
          type: string
        - in: body
          name: body
          description: Request contract
          required: true
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionNotes'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionNotes'
      security:
        - x-functions-key: [ ]
  '/api/applications/{appName}/subscriptions/{subscriptionNameOrId}/AddOwner':
    post:
      tags:
        - Subscription
      summary: Add owner to a subscription
      operationId: postApiApplicationsByAppNameSubscriptionsBySubscriptionNameOrIdAddOwner
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: path
          name: subscriptionNameOrId
          description: Name or id of the subscription
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the creator
          required: true
          type: string
        - in: body
          name: body
          description: Request contract
          required: true
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionOwner'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionOwner'
      security:
        - x-functions-key: [ ]
  '/api/applications/{appName}/subscriptions/{subscriptionNameOrId}/RegenerateKey':
    post:
      tags:
        - Subscription
      summary: Regenerate a subscription key
      operationId: postApiApplicationsByAppNameSubscriptionsBySubscriptionNameOrIdRegenerateKey
      produces:
        - application/json
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: path
          name: subscriptionNameOrId
          description: Name or id of the subscription
          required: true
          type: string
        - in: query
          name: key-name
          description: The name of the key. Either PrimaryKey or SecondaryKey
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the creator
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionKeys'
      security:
        - x-functions-key: [ ]
  '/api/applications/{appName}/subscriptions/{subscriptionNameOrId}/RemoveOwner':
    post:
      tags:
        - Subscription
      summary: Remove owner to a subscription
      operationId: postApiApplicationsByAppNameSubscriptionsBySubscriptionNameOrIdRemoveOwner
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: appName
          description: Name of Luna application
          required: true
          type: string
        - in: path
          name: subscriptionNameOrId
          description: Name or id of the subscription
          required: true
          type: string
        - in: header
          name: Luna-User-Id
          description: The user id of the creator
          required: true
          type: string
        - in: body
          name: body
          description: Request contract
          required: true
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionOwner'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionOwner'
      security:
        - x-functions-key: [ ]
  '/api/marketplace/offers/{offerId}/offerparameters':
    get:
      tags:
        - Azure Marketplace
      summary: Get offer parameters
      operationId: getApiMarketplaceOffersByOfferIdOfferparameters
      produces:
        - application/json
      parameters:
        - in: path
          name: offerId
          description: The offer ID
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.MarketplaceOfferParameter'
            example:
              ParameterName: region
              DisplayName: Region
              Description: The Azure region where resources are deployed to.
              ValueType: string
              FromList: true
              ValueList: westus;eastus
              Maximum: 0
              Minimum: 0
      security:
        - x-functions-key: [ ]
  /api/marketplace/subscriptions/resolveToken:
    post:
      tags:
        - Azure Marketplace
      summary: Resolve Azure Marketplace subscription from token
      operationId: postApiMarketplaceSubscriptionsResolveToken
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: Token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.MarketplaceSubscription'
      security:
        - x-functions-key: [ ]
  '/api/marketplace/subscriptions/{subscriptionId}':
    put:
      tags:
        - Azure Marketplace
      summary: Create Azure Marketplace subscription
      operationId: putApiMarketplaceSubscriptionsBySubscriptionId
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: subscriptionId
          description: ID of the subscription
          required: true
          type: string
        - in: body
          name: body
          description: The subscription
          required: true
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.MarketplaceSubscription'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.MarketplaceSubscription'
      security:
        - x-functions-key: [ ]
    delete:
      tags:
        - Azure Marketplace
      summary: Unsubscribe a Azure Marketplace subscription
      operationId: deleteApiMarketplaceSubscriptionsBySubscriptionId
      parameters:
        - in: path
          name: subscriptionId
          description: ID of the subscription
          required: true
          type: string
      responses:
        '204':
          description: Success
      security:
        - x-functions-key: [ ]
  '/api/marketplace/subscriptions/{subscriptionId}/activate':
    post:
      tags:
        - Azure Marketplace
      summary: Activate a Azure Marketplace subscription
      operationId: postApiMarketplaceSubscriptionsBySubscriptionIdActivate
      parameters:
        - in: path
          name: subscriptionId
          description: ID of the subscription
          required: true
          type: string
      responses:
        '204':
          description: Success
      security:
        - x-functions-key: [ ]
definitions:
  Luna.Gallery.Public.Client.DataContracts.PublishedLunaApplication:
    required:
      - UniqueName
      - DisplayName
      - Description
      - Publisher
      - Tags
    type: object
    properties:
      UniqueName:
        type: string
      DisplayName:
        type: string
      Description:
        type: string
      LogoImageUrl:
        type: string
      DocumentationUrl:
        type: string
      Publisher:
        type: string
      Tags:
        type: array
        items:
          $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaPublishedApplicationTag'
      Details:
        $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationDetails'
    example:
      UniqueName: mylunaapp
      DisplayName: My Luna App
      Description: This is my Luna app
      LogoImageUrl: https://aka.ms/lunalog.png
      DocumentationUrl: https://aka.ms/lunadoc
      Publisher: Microsoft
      Tags: [ ]
      Details:
        APIs: [ ]
  Luna.Gallery.Public.Client.DataContracts.LunaPublishedApplicationTag:
    type: object
    properties:
      Name:
        type: string
      Value:
        type: string
  Luna.Gallery.Public.Client.DataContracts.LunaApplicationDetails:
    type: object
    properties:
      APIs:
        type: array
        items:
          $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaAPIDetails'
  Luna.Gallery.Public.Client.DataContracts.LunaAPIDetails:
    type: object
    properties:
      Name:
        type: string
      Type:
        type: string
      Versions:
        type: array
        items:
          $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaAPIVersionDetails'
  Luna.Gallery.Public.Client.DataContracts.LunaAPIVersionDetails:
    type: object
    properties:
      Name:
        type: string
      Operations:
        type: array
        items:
          type: string
  Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscription:
    required:
      - SubscriptionId
      - SubscriptionName
    type: object
    properties:
      SubscriptionId:
        format: uuid
        type: string
        example: 00000000-0000-0000-0000-000000000000
      SubscriptionName:
        type: string
      PrimaryKey:
        type: string
      SecondaryKey:
        type: string
      BaseUrl:
        type: string
      Notes:
        type: string
      Owners:
        type: array
        items:
          $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionOwner'
      CreatedTime:
        format: date-time
        type: string
    example:
      SubscriptionId: 43ebb35e-be1a-4dbf-92da-fb8a069d6a2c
      SubscriptionName: mysub
      PrimaryKey: a76e55da5d6c4a489c4f5e4033ac3488
      SecondaryKey: d235f6c4bf86495c9dd37c1f44f817ac
      BaseUrl: https://luna.azurewebapp.net/api
      Notes: this is my subscription
      Owners:
        - UserId: fcd14a2a-31d3-49c1-9e1b-39063da1ac6a
          UserName: FirstName LastName
      CreatedTime: '2021-06-07T15:36:51.3036072+00:00'
  Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionOwner:
    required:
      - UserId
    type: object
    properties:
      UserId:
        type: string
      UserName:
        type: string
    example:
      UserId: 114b34b1-4f9a-4888-926a-b222d3b36ef6
      UserName: FirstName LastName
  Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionNotes:
    required:
      - Notes
    type: object
    properties:
      Notes:
        type: string
    example:
      Notes: this is my subscription
  Luna.Gallery.Public.Client.DataContracts.LunaApplicationSubscriptionKeys:
    required:
      - PrimaryKey
      - SecondaryKey
    type: object
    properties:
      PrimaryKey:
        type: string
      SecondaryKey:
        type: string
    example:
      PrimaryKey: d2e08a34e16a4f3784d264eac0cb2419
      SecondaryKey: 594f7df5853645148c1ed8ce49a7af15
  Luna.Gallery.Public.Client.DataContracts.MarketplaceOfferParameter:
    required:
      - ParameterName
      - DisplayName
      - Description
      - ValueType
      - FromList
      - ValueList
      - Maximum
      - Minimum
    type: object
    properties:
      ParameterName:
        type: string
      DisplayName:
        type: string
      Description:
        type: string
      ValueType:
        type: string
      FromList:
        type: boolean
      ValueList:
        type: string
      Maximum:
        format: int32
        type: integer
      Minimum:
        format: int32
        type: integer
  Luna.Gallery.Public.Client.DataContracts.MarketplaceSubscription:
    required:
      - Id
      - PublisherId
      - OfferId
      - Name
      - PlanId
    type: object
    properties:
      Id:
        format: uuid
        type: string
        example: 00000000-0000-0000-0000-000000000000
      PublisherId:
        type: string
      OfferId:
        type: string
      Name:
        type: string
      SaaSSubscriptionStatus:
        type: string
      PlanId:
        type: string
      AllowedCustomerOperations:
        type: array
        items:
          type: string
      Token:
        type: string
      InputParameters:
        type: array
        items:
          $ref: '#/definitions/Luna.Gallery.Public.Client.DataContracts.MarketplaceSubscriptionParameter'
    example:
      Id: 0cedb5f2-51e7-40f1-bd74-27c6b8fda858
      PublisherId: ms-ace
      OfferId: textanalytics
      Name: My sub
      SaaSSubscriptionStatus: Subscribed
      PlanId: default
      AllowedCustomerOperations: [ ]
      Token: 
      InputParameters: [ ]
  Luna.Gallery.Public.Client.DataContracts.MarketplaceSubscriptionParameter:
    type: object
    properties:
      Name:
        type: string
      Type:
        type: string
      Value:
        type: string
securityDefinitions:
  x-functions-key:
    type: apiKey
    name: x-functions-key
    in: header
    description: Azure function key